<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Note</title>

<style>
:root{
  --bg:#0f1115;
  --panel:#161922;
  --panel2:#1c2030;
  --text:#eaeaf0;
  --line:#2a2f44;
}
body{
  margin:0;
  font-family:system-ui,Segoe UI,Roboto,sans-serif;
  background:var(--bg);
  color:var(--text);
}
.top{
  position:fixed;
  top:0; left:0;
  width:100%;
  height:48px;
  background:var(--panel);
  display:flex;
  align-items:center;
  padding:0 10px;
}
.top button{
  border:none;
  background:var(--panel2);
  color:white;
  border-radius:8px;
  padding:6px 10px;
}
.viewer{
  padding:70px 16px 16px;
}
.note{
  background:var(--panel2);
  padding:16px;
  border-radius:12px;
}
.popup{
  position:fixed;
  top:120px;
  left:20px;
  width:320px;
  background:var(--panel);
  border-radius:12px;
  padding:10px;
  display:none;
}
.popup header{
  font-size:12.5px;
  margin-bottom:6px;
  cursor:move;
}
.popup textarea{
  width:100%;
  height:160px;
  background:var(--panel2);
  color:var(--text);
  border:none;
  border-radius:8px;
  padding:8px;
}
</style>
</head>

<body>
<div class="top">
  <button onclick="history.back()">← Back</button>
  <button style="margin-left:auto" onclick="closePop()">✕</button>
</div>

<div class="viewer">
  <div class="note" id="render"></div>
</div>

<div class="popup" id="popup">
  <header id="drag">Edit Markdown</header>
  <textarea id="editor"></textarea>
  <button onclick="saveEdit()">Save</button>
</div>

<script>
const idx=location.hash.slice(1);
let folders=JSON.parse(localStorage.getItem("folders"));
let content=folders[idx].content;

const renderEl=document.getElementById("render");
const pop=document.getElementById("popup");
const editor=document.getElementById("editor");

function md(t){
  return t
    .replace(/^# (.*$)/gim,"<h1>$1</h1>")
    .replace(/^## (.*$)/gim,"<h2>$1</h2>")
    .replace(/\*\*(.*?)\*\*/g,"<b>$1</b>")
    .replace(/\n/g,"<br>");
}
function render(){
  renderEl.innerHTML=md(content);
}
render();

renderEl.onclick=()=>{
  editor.value=content;
  pop.style.display="block";
};
function saveEdit(){
  content=editor.value;
  folders[idx].content=content;
  localStorage.setItem("folders",JSON.stringify(folders));
  pop.style.display="none";
  render();
}
function closePop(){
  pop.style.display="none";
}

/* draggable popup */
let dx,dy,drag=false;
drag.onmousedown=e=>{
  drag=true;dx=e.offsetX;dy=e.offsetY;
};
document.onmousemove=e=>{
  if(drag){
    pop.style.left=e.pageX-dx+"px";
    pop.style.top=e.pageY-dy+"px";
  }
};
document.onmouseup=()=>drag=false;
</script>
</body>
</html>
