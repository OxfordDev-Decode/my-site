<!DOCTYPE html>
<html>
<head>
  <title>Public Group Name System</title>
  <meta charset="utf-8">
  <style>
    body { font-family: sans-serif; padding: 20px; }
    input, button { padding: 5px; margin: 5px; }
    ul { list-style: none; padding-left: 0; }
    li { background: #eee; margin: 3px 0; padding: 5px; border-radius: 4px; }
    a { color: blue; }
  </style>
</head>
<body>
  <h1>Public Group Name System</h1>
  
  <button onclick="createGroup()">Create New Group</button>
  <button onclick="copyLink()">Copy Link</button>
  <p id="groupLink"></p>

  <div id="joinSection" style="display:none;">
    <input id="name" placeholder="Enter your name">
    <button onclick="addName()">Join Group</button>
    
    <h2>Members:</h2>
    <ul id="list"></ul>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

  <script>
    // ====== Your Firebase config ======
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      databaseURL: "https://YOUR_PROJECT.firebaseio.com",
      projectId: "YOUR_PROJECT",
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const groupLinkEl = document.getElementById("groupLink");
    const listEl = document.getElementById("list");
    const joinSection = document.getElementById("joinSection");

    // ====== Get group ID from URL query string ======
    const params = new URLSearchParams(window.location.search);
    let group = params.get("group") || null;

    // ====== Create a new group ======
    function createGroup() {
      group = Math.random().toString(36).substring(2, 8); // random group id
      const link = window.location.origin + window.location.pathname + "?group=" + group;
      groupLinkEl.innerHTML = `Share this link: <a href="${link}">${link}</a>`;
      joinSection.style.display = "block";
      listEl.innerHTML = "";
      db.ref("rooms/" + group + "/users").set({}); // initialize group
    }

    // ====== Copy link button ======
    function copyLink() {
      if (!group) { alert("Create or open a group first!"); return; }
      const link = window.location.origin + window.location.pathname + "?group=" + group;
      navigator.clipboard.writeText(link)
        .then(() => alert("Link copied!"))
        .catch(() => alert("Failed to copy link"));
    }

    // ====== Add user name to group and show immediately ======
    function addName() {
      if (!group) { alert("Create or open a group first!"); return; }
      const nameInput = document.getElementById("name");
      const name = nameInput.value.trim();
      if (name === "") return;

      // Push to Firebase
      db.ref("rooms/" + group + "/users").push(name);

      // Show name immediately in the list
      const li = document.createElement("li");
      li.textContent = name;
      listEl.appendChild(li);

      nameInput.value = "";
    }

    // ====== Listen for all names in this group ======
    if (group) {
      joinSection.style.display = "block";

      // Sync from Firebase (for other people's names)
      db.ref("rooms/" + group + "/users").on("value", snapshot => {
        listEl.innerHTML = ""; // clear list
        snapshot.forEach(child => {
          const li = document.createElement("li");
          li.textContent = child.val();
          listEl.appendChild(li);
        });
      });

      const link = window.location.origin + window.location.pathname + "?group=" + group;
      groupLinkEl.innerHTML = `Share this link: <a href="${link}">${link}</a>`;
    }
  </script>
</body>
</html>
